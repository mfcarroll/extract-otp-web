<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OTP Secret Extractor</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Readex+Pro&display=swap"
      rel="stylesheet"
    />
    <script>
      // Immediately check for camera support and add a class to the html element.
      // This runs before the body is rendered, preventing any flicker.
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        document.documentElement.classList.add("camera-supported");
      }
    </script>
    <link rel="stylesheet" href="/src/style.css" />
  </head>

  <body>
    <div class="page-container">
      <main id="app">
        <h1>One-Time Password Secret Extractor</h1>

        <div id="info-tabs">
          <!-- 1. Tabs Section -->
          <div
            class="tab-buttons navigable-section"
            role="tablist"
            aria-label="Information tabs"
          >
            <button
              class="tab-button navigable active"
              id="tab-btn-what"
              data-tab="what"
              tabindex="0"
              role="tab"
              aria-selected="true"
              aria-controls="tab-what"
            >
              What is this?
            </button>
            <button
              class="tab-button navigable"
              id="tab-btn-use"
              tabindex="-1"
              data-tab="use"
              role="tab"
              aria-selected="false"
              aria-controls="tab-use"
            >
              How do I use it?
            </button>
            <button
              class="tab-button navigable"
              id="tab-btn-faq"
              tabindex="-1"
              data-tab="faq"
              role="tab"
              aria-selected="false"
              aria-controls="tab-faq"
            >
              FAQ
            </button>
          </div>

          <!-- 2. Tab Content Section -->
          <div class="tab-content-wrapper">
            <div
              id="tab-what"
              class="tab-content active"
              role="tabpanel"
              aria-labelledby="tab-btn-what"
            >
              <p>
                This tool extracts One-Time Password secrets from the Google
                Authenticator or LastPass Authenticator apps. There is no
                software to install, and no data ever leaves your device.
              </p>
              <p>
                <strong
                  >All of the processing of your QR codes and secrets happens
                  entirely locally, right here in your browser.</strong
                >
              </p>
            </div>

            <div
              id="tab-use"
              class="tab-content"
              role="tabpanel"
              aria-labelledby="tab-btn-use"
              hidden
            >
              <p>
                This tool reads QR codes from Google Authenticator or LastPass
                Authenticator's export feature and gives you back the original
                secret for each account. You can then use these secrets to
                import your accounts into any other authenticator app.
              </p>
              <h3>1. Export from your One-Time Password App</h3>
              <h4>Export from Google Authenticator</h4>
              <ul>
                <li>Open the Google Authenticator app on your phone.</li>
                <li>
                  Go to the menu and select "Transfer accounts" > "Export
                  accounts".
                </li>
                <li>Select the accounts you wish to export.</li>
                <li>Take a screenshot of each QR code that is displayed.</li>
              </ul>
              <h4>Export from LastPass</h4>
              <ul>
                <li>Open the LastPass Authenticator on your phone.</li>
                <li>
                  Click on the cog and select "Transfer accounts" > "Export
                  accounts to QR code".
                </li>
                <li>Take a screenshot of each QR code that is displayed.</li>
              </ul>
              <p>
                (For lastpass, you can also choose "Export accounts to file" and
                upload that instead. This tool supports both formats.)
              </p>

              <h3>2. Extract Secrets</h3>
              <ul>
                <li>
                  Click "Select QR Code Image(s)" or drag and drop your
                  screenshot(s) onto the page.
                </li>
              </ul>
              <h3>3. Use Your Secrets</h3>
              <ul>
                <li>
                  The tool will display the extracted OTP secrets, each with its
                  own QR code and secret key.
                </li>
                <li>
                  You can now import these secrets into your preferred
                  authenticator app or password manager.
                </li>
              </ul>
            </div>

            <div
              id="tab-faq"
              class="tab-content navigable-section"
              role="tabpanel"
              aria-labelledby="tab-btn-faq"
              hidden
            >
              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-1-button"
                    aria-expanded="false"
                    aria-controls="faq-1-answer"
                  >
                    <span class="faq-title">Why is this needed?</span>
                  </button>
                </h3>
                <div
                  id="faq-1-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-1-button"
                >
                  <p>
                    Google Authenticator lets you transfer your accounts to a
                    new phone, but it doesn't provide an easy way to export them
                    to other apps like 1Password or Bitwarden. This is because
                    it hides the original "secret" (the QR code you first
                    scanned) for each account.
                  </p>
                  <p>
                    Without these secrets, moving to a new password manager
                    means manually re-configuring 2FA for every single account,
                    which is a huge pain.
                  </p>
                  <p>
                    While other tools exist to solve this, they often require
                    technical steps like running scripts or installing software.
                    This tool is designed to be a simple, secure solution that
                    anyone can use.
                  </p>
                </div>
              </div>

              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-2-button"
                    aria-expanded="false"
                    aria-controls="faq-2-answer"
                  >
                    <span class="faq-title">How does it work?</span>
                  </button>
                </h3>
                <div
                  id="faq-2-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-2-button"
                >
                  <p>
                    You provide screenshots of the QR codes from Google
                    Authenticator's export feature. This tool reads those QR
                    codes&mdash;right here in your browser&mdash;and gives you
                    back the original secret for each account. You can then use
                    these secrets to import your accounts into any other
                    authenticator app.
                  </p>
                </div>
              </div>

              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-3-button"
                    aria-expanded="false"
                    aria-controls="faq-3-answer"
                  >
                    <span class="faq-title"
                      >Is it safe to &ldquo;upload&rdquo; my QR codes?</span
                    >
                  </button>
                </h3>
                <div
                  id="faq-3-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-3-button"
                >
                  <p>
                    Yes. Security and privacy are the top priorities.
                    <strong
                      >Nothing you do here ever leaves your computer or mobile
                      device.</strong
                    >
                    All processing happens locally, right in your browser. Your
                    QR code images and secrets are never sent to any server.
                  </p>
                  <p>
                    This tool is open-source and
                    <a
                      href="https://github.com/mfcarroll/extract-otp-web"
                      target="_blank"
                      rel="noopener noreferrer"
                      >the code can be inspected by anyone</a
                    >, to verify its safety and methodology. It is hosted on
                    GitHub pages, providing a
                    <a
                      href="https://github.com/mfcarroll/extract-otp-web/deployments/github-pages"
                      target="_blank"
                      rel="noopener noreferrer"
                      >secure and transparent deployment process</a
                    >.
                  </p>
                </div>
              </div>

              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-4-button"
                    aria-expanded="false"
                    aria-controls="faq-4-answer"
                  >
                    <span class="faq-title"
                      >Why doesn't Google Authenticator show my original QR
                      codes?</span
                    >
                  </button>
                </h3>
                <div
                  id="faq-4-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-4-button"
                >
                  <p>
                    Google Authenticator makes it difficult to view the original
                    secrets used to set up your accounts. Instead, they provide
                    an export QR code that bundles all your accounts together.
                    This makes it easy to transfer to a new device, but
                    difficult to switch to a different authenticator app.
                    LastPass also provides individual QR codes for each account,
                    which is a huge improvement, but it only provides the text
                    secrets in a JSON code format. In contrast, apps like
                    1Password make the original secrets easily accessible,
                    allowing for simple transfers to other 2FA apps.
                  </p>
                </div>
              </div>

              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-5-button"
                    aria-expanded="false"
                    aria-controls="faq-5-answer"
                  >
                    <span class="faq-title"
                      >Why can't 1Password import from Google
                      Authenticator?</span
                    >
                  </button>
                </h3>
                <div
                  id="faq-5-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-5-button"
                >
                  <p>
                    That's a great question, and one that
                    <a
                      href="https://www.1password.community/discussions/1password/import-all-google-authenticator-2fas-to-1password/38418"
                      target="_blank"
                      rel="noopener noreferrer"
                      aria-label="1Password community discussion about importing from Google Authenticator"
                    >
                      others</a
                    >, have
                    <a
                      href="https://www.reddit.com/r/1Password/comments/qm8v2i/add_existing_2fa_to_1password/"
                      target="_blank"
                      rel="noopener noreferrer"
                      aria-label="Reddit discussion about adding existing 2FA to 1Password"
                      >asked</a
                    >. One reason given is a concern that Google's export format
                    might change. However, this format has been stable for
                    years, and other apps (like
                    <a
                      href="https://getaegis.app/"
                      target="_blank"
                      rel="noopener noreferrer"
                      >Aegis Authenticator</a
                    >) support it without issue. It seems password managers like
                    1Password <em>could</em> easily support direct imports, but
                    have chosen not to.
                  </p>
                </div>
              </div>

              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-6-button"
                    aria-expanded="false"
                    aria-controls="faq-6-answer"
                  >
                    <span class="faq-title">Who made this?</span>
                  </button>
                </h3>
                <div
                  id="faq-6-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-6-button"
                >
                  <p>
                    This tool was created by
                    <a
                      href="https://www.linkedin.com/in/matthewfcarroll/"
                      rel="noopener noreferrer"
                      target="_blank"
                      >Matthew Carroll</a
                    >, a developer who was frustrated with the process of
                    migrating OTP codes from Google Authenticator into
                    1Password.
                  </p>
                </div>
              </div>

              <div class="faq-item">
                <h3>
                  <button
                    class="faq-button navigable"
                    tabindex="-1"
                    id="faq-7-button"
                    aria-expanded="false"
                    aria-controls="faq-7-answer"
                  >
                    <span class="faq-title">Acknowledgements</span>
                  </button>
                </h3>
                <div
                  id="faq-7-answer"
                  class="faq-answer"
                  role="region"
                  aria-labelledby="faq-7-button"
                >
                  <p>
                    This tool builds on the work of several open-source
                    projects, including:
                  </p>
                  <ul>
                    <li>
                      <a
                        href="https://github.com/scito/extract_otp_secrets/#readme"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Extract OTP Secrets</a
                      >, the python script by
                      <a
                        href="https://scito.ch/"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Roland Kurmann</a
                      >, on which this tool is based.
                    </li>
                    <li>
                      <a
                        href="https://github.com/beemdevelopment/Aegis/#readme"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Aegis Authenticator
                      </a>
                      and
                      <a
                        href="https://github.com/qistoph/otp_export/#readme"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Chris van Marle</a
                      >, for the export protobuf specification.
                    </li>
                    <li>
                      <a
                        href="https://github.com/krissrex/google-authenticator-exporter/#readme"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Google Authenticator Exporter</a
                      >, another python script solution to the same problem.
                    </li>
                  </ul>
                  <p>
                    The user interface and QR code processing are powered by
                    these open-source libraries:
                  </p>
                  <ul>
                    <li>
                      <a
                        href="https://github.com/cozmo/jsQR"
                        target="_blank"
                        rel="noopener noreferrer"
                        >jsQR</a
                      >
                      for decoding QR codes from images.
                    </li>
                    <li>
                      <a
                        href="https://github.com/protobufjs/protobuf.js"
                        target="_blank"
                        rel="noopener noreferrer"
                        >protobuf.js</a
                      >
                      for decoding the Google Authenticator data payload.
                    </li>
                    <li>
                      <a
                        href="https://github.com/soldair/node-qrcode"
                        target="_blank"
                        rel="noopener noreferrer"
                        >qrcode</a
                      >
                      for generating new QR codes for each account.
                    </li>
                    <li>
                      <a
                        href="https://github.com/wzrdtales/thirty-two"
                        target="_blank"
                        rel="noopener noreferrer"
                        >thirty-two</a
                      >
                      for Base32 encoding the OTP secrets.
                    </li>
                    <li>
                      <a
                        href="https://github.com/FortAwesome/Font-Awesome"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Font Awesome</a
                      >
                      for the icons used in the UI.
                    </li>
                  </ul>
                  <p>
                    Thank you to all the contributers to these excellent
                    projects!
                  </p>
                  <p>
                    <a
                      href="https://codeassist.google.com/"
                      target="_blank"
                      rel="noopener noreferrer"
                      >Gemini Code Assist</a
                    >
                    was used during the development of this tool. All
                    AI-generated code has been carefully manually reviewed.
                  </p>
                  <div class="donation-section">
                    <a
                      class="logo-link"
                      href="https://stand.earth/"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      <span class="logo-with-tagline">
                        <img
                          class="logo"
                          src="/Stand_Logo_Block-RGB_Red.svg"
                          alt="Stand.earth"
                        />
                        <span class="tagline"
                          >For the people and places you love</span
                        >
                      </span></a
                    >
                    <p class="text">
                      The development of this tool was made possible in part
                      through the support of
                      <a
                        href="https://stand.earth/"
                        target="_blank"
                        rel="noopener noreferrer"
                        >Stand.earth</a
                      >. If you find this useful, please consider
                      <a
                        href="https://stand.earth/donate/"
                        target="_blank"
                        rel="noopener noreferrer"
                        >making a donation</a
                      >
                      to support Stand's work.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 3. File Upload Section -->
        <div class="file-input-wrapper navigable-section">
          <div class="file-input-buttons">
            <label
              for="qr-input"
              class="file-input-label btn btn-primary navigable"
              role="button"
              tabindex="0"
            >
              <span class="label-idle">
                <i class="fa fa-upload"></i> Select Image(s)
              </span>
              <span class="label-processing">
                <i class="fa fa-spinner fa-spin"></i> Processing...
              </span>
            </label>
            <button
              id="take-photo-button"
              class="btn btn-primary navigable"
              tabindex="0"
            >
              <i class="fa fa-camera"></i> Scan QR Code
            </button>
          </div>

          <div class="drop-text">or drag and drop files here</div>
          <div id="upload-log-container">
            <ul id="upload-log-list"></ul>
          </div>
          <input
            type="file"
            id="qr-input"
            accept="image/*,application/json,.json,text/csv,.csv"
            multiple
          />
        </div>

        <div id="error-message-container" class="navigable-section"></div>

        <!-- 4. Results Container (each card inside is its own section) -->
        <div
          id="results-container"
          role="grid"
          aria-label="Extracted OTP Accounts"
        ></div>

        <template id="otp-card-template">
          <!-- Each card is its own navigable section -->
          <div
            class="otp-card navigable-section navigable"
            role="row"
            tabindex="0"
          >
            <span class="otp-card-index"></span>
            <input
              type="checkbox"
              class="visually-hidden otp-select-checkbox"
              tabindex="-1"
            />
            <div class="otp-details" role="presentation">
              <!-- The h3 will be programmatically linked to the row as its label -->
              <h3 class="otp-title"></h3>
              <p class="detail-row">
                <span class="label">Name:</span> <span data-value="name"></span>
              </p>
              <p class="detail-row">
                <span class="label">Issuer:</span>
                <span data-value="issuer"></span>
              </p>
              <p class="detail-row">
                <span class="label">Type:</span> <span data-value="type"></span>
              </p>
              <p class="detail-row counter-row">
                <span class="label">Counter:</span>
                <span data-value="counter"></span>
              </p>
              <p class="detail-row secret-row">
                <label class="label">Secret:</label>
                <span class="secret-container">
                  <textarea
                    class="text-input secret-input navigable"
                    readonly
                    role="gridcell"
                    tabindex="-1"
                    rows="1"
                  ></textarea>
                  <button
                    class="copy-button navigable"
                    role="gridcell"
                    tabindex="-1"
                  >
                    <i class="fa fa-copy" aria-hidden="true"></i>
                    <span class="visually-hidden">Copy secret</span>
                  </button>
                </span>
              </p>
              <p class="detail-row otp-url-row">
                <label class="label">URL:</label>
                <span class="otp-url-container">
                  <textarea
                    class="text-input url-input navigable"
                    readonly
                    role="gridcell"
                    tabindex="-1"
                    rows="1"
                  ></textarea>
                  <button
                    class="copy-button navigable"
                    role="gridcell"
                    tabindex="-1"
                  >
                    <i class="fa fa-copy" aria-hidden="true"></i>
                    <span class="visually-hidden">Copy URL</span>
                  </button>
                </span>
              </p>
              <p class="visually-hidden card-actions-help">
                Press Enter or Space to copy.
              </p>
              <div class="detail-row qr-code-row">
                <span class="label">QR:</span>
                <button
                  class="qr-code-container navigable"
                  role="gridcell"
                  tabindex="-1"
                >
                  <canvas></canvas>
                  <span class="visually-hidden">Show larger QR code</span>
                  <small class="qr-enlarge-hint" aria-hidden="true"
                    >Tap to enlarge</small
                  >
                </button>
              </div>
            </div>
          </div>
        </template>

        <!-- 5. Results Buttons Section -->
        <div id="export-container" style="display: none">
          <div
            id="selection-controls"
            class="navigable-section"
            style="display: none"
          >
            <span id="selection-count">0 selected</span>
            <button
              id="select-all-button"
              class="btn btn-secondary btn-small navigable"
            >
              Select All
            </button>
            <button
              id="deselect-all-button"
              class="btn btn-secondary btn-small navigable"
            >
              Select None
            </button>
            <button
              id="clear-all-button"
              class="btn btn-danger btn-small navigable"
            >
              <i class="fa fa-trash"></i> Reset
            </button>
          </div>
          <div class="main-export-actions">
            <div class="export-button-row navigable-section">
              <button
                id="download-csv-button"
                class="btn btn-success navigable"
              >
                <i class="fa fa-download"></i> Save as CSV
              </button>
              <button
                id="download-json-button"
                class="btn btn-success navigable"
              >
                <i class="fa fa-download"></i> Save as JSON
              </button>
            </div>
            <div class="export-button-row navigable-section">
              <button
                id="export-google-button"
                class="btn btn-primary navigable"
              >
                <i class="fa-brands fa-google"></i> Export to Google
              </button>
              <button
                id="export-lastpass-button"
                class="btn btn-primary navigable"
              >
                <i class="fa-solid fa-key"></i> Export to LastPass
              </button>
            </div>
          </div>
        </div>
      </main>

      <!-- 6. Footer Section -->
      <footer class="navigable-section">
        <div class="footer-content">
          <span>&copy; <span id="copyright-year"></span></span>
          <a
            id="author-link"
            class="navigable"
            href="https://www.linkedin.com/in/matthewfcarroll/"
            target="_blank"
            rel="noopener noreferrer"
            >Matthew Carroll</a
          >
          <span class="footer-separator">|</span>
          <a
            id="source-code-link"
            class="navigable"
            href="https://github.com/mfcarroll/extract-otp-web"
            target="_blank"
            rel="noopener noreferrer"
            >Source Code</a
          >
          <span class="footer-separator">|</span>
          <div
            id="theme-switcher-wrapper"
            class="theme-switcher-wrapper navigable"
            role="button"
            tabindex="0"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <span class="visually-hidden">Open theme switcher</span>
            <div class="theme-switcher" role="menu">
              <button
                class="navigable"
                data-theme="system"
                role="menuitemradio"
                aria-checked="false"
              >
                <i class="fa fa-desktop"></i>
                <span class="visually-hidden">Switch to system theme</span>
              </button>
              <button
                class="navigable"
                data-theme="light"
                role="menuitemradio"
                aria-checked="false"
              >
                <i class="fa fa-sun"></i>
                <span class="visually-hidden">Switch to light theme</span>
              </button>
              <button
                class="navigable"
                data-theme="dark"
                role="menuitemradio"
                aria-checked="false"
              >
                <i class="fa fa-moon"></i>
                <span class="visually-hidden">Switch to dark theme</span>
              </button>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <div
      id="qr-modal"
      class="modal-overlay"
      role="dialog"
      aria-modal="true"
      style="display: none"
    >
      <button class="modal-close navigable" aria-label="Close">&#x2715;</button>
      <div id="modal-content"></div>
    </div>
    <div
      id="camera-modal"
      class="modal-overlay"
      role="dialog"
      aria-modal="true"
      style="display: none"
    >
      <div class="camera-container">
        <video id="camera-video" playsinline></video>
        <div class="camera-reticle"></div>
        <div id="camera-title" class="camera-scan-text">Scan QR Code</div>
        <canvas id="camera-canvas" style="display: none"></canvas>
        <button
          id="camera-cancel"
          class="modal-close navigable"
          aria-label="Close"
        >
          &#x2715;
        </button>
      </div>
    </div>
    <div id="drag-overlay"></div>
    <!-- Visually hidden live region for screen reader announcements -->
    <div
      class="visually-hidden"
      id="sr-announcer"
      aria-live="polite"
      aria-atomic="true"
    ></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
